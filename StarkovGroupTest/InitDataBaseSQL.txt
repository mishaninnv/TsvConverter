/*Делаем запрос на создание нашей базы данных*/
create database "Starkov";


/*Переключаемся на созданную базу данных и выполняем следующий запрос целиком*/
begin;

CREATE TABLE public."JobTitle" (
	"Name" text NOT NULL,
	"ID" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	CONSTRAINT "AK_JobTitle_ID" UNIQUE ("ID"),
	CONSTRAINT "PK_JobTitle" PRIMARY KEY ("Name")
);

CREATE TABLE public."Departments" (
	"ID" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Name" text NOT NULL,
	"Phone" text NOT NULL,
	"ParentID" int4 NULL,
	"ManagerID" int4 NULL,
	CONSTRAINT "PK_Departments" PRIMARY KEY ("ID")
);
CREATE INDEX "IX_Departments_ManagerID" ON public."Departments" USING btree ("ManagerID");
CREATE INDEX "IX_Departments_ParentID" ON public."Departments" USING btree ("ParentID");

CREATE TABLE public."Employees" (
	"FullName" text NOT NULL,
	"ID" int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Login" text NOT NULL,
	"Password" text NOT NULL,
	"JobTitle" int4 NOT NULL,
	"Department" int4 NOT NULL,
	CONSTRAINT "AK_Employees_ID" UNIQUE ("ID"),
	CONSTRAINT "PK_Employees" PRIMARY KEY ("FullName")
);
CREATE INDEX "IX_Employees_Department" ON public."Employees" USING btree ("Department");
CREATE INDEX "IX_Employees_JobTitle" ON public."Employees" USING btree ("JobTitle");

ALTER TABLE public."Employees" ADD FOREIGN KEY ("Department") REFERENCES public."Departments"("ID") ON DELETE cascade;
ALTER TABLE public."Employees" add FOREIGN KEY ("JobTitle") REFERENCES public."JobTitle"("ID") ON DELETE CASCADE;

ALTER TABLE public."Departments" add FOREIGN KEY ("ParentID") REFERENCES public."Departments"("ID");
ALTER TABLE public."Departments" add FOREIGN KEY ("ManagerID") REFERENCES public."Employees"("ID");

commit;